# DB 기본 지식


## 데이터정규화

중복을 최소화 하도록 DB를 설계하는걸 의미한다.
6단계까지 있고 보통은 3단계 까지만 한다고 한다.

1. 각 컬럼이 원자성이 있어야 한다. (하나의 속성, 유일한 이름 등)
	
	컬럼이름 중복이나 한 컬럼의 속성 2개 이상 포함하면 안됨
2. 부분 함수 종속이 없어야한다.
   
   각 컬럼들이 모든 기본키에 종속되어 있어야한다. 
   기본키에 종속되어 있지 않은 컬럼이 존재하면 테이블 분할
   
   현재 테이블 주제와 상관없는 컬럼은 다른 테이블로 뺀다고 생각하면 되겠다.
3. 이행 함수 종속 제거 (a -> b, b -> c 이면 a -> c 인 경우가 없어야 함)

	기본키가 아닌 일반 컬럼에만 종속되어있는 컬럼은 분할하자


## ORM

객체지향 프로그래밍과 관계형 DB 간의 매핑을 자동화 해주는 툴

**장점**
* SQL문이 아닌 Method로 DB를 조작할 수 있어 객체지향 방식으로 데이터베이스 작업 수행해서 개발 생산성 향상
* 코드 간결성 및 유지보수성 향상
* 데이터 베이스 독립성

## N + 1 문제
ORM을 사용할 때 1 : N 또는 N : 1 연관관계 테이블에서 발생할 수 있는 성능 문제

ORM 은 기본설정에 따라 즉시로딩, 지연로딩으로 나누어지는데

즉시로딩은 테이블을 조회할 때 연관관계에 있는 테이블도 함께 로딩

지연 로딩은 조회한 테이블만 로딩하는걸 의미한다.

(JPA는 지연로딩)

발생상황

- 즉시로딩
1. 하나의 쿼리로 부모 앤티티를 검색
2. 하위 앤티티가 필요하지 않은 상황이여도 함께 조회
3. 성능 이슈 발생
- 지연 로딩
1. 하나의 쿼리로 부모 앤티티 검색
2. 하위 앤티티가 필요한 상황이지만 포함되어있지 않음
3. 하위 앤티티 수만큼 쿼리 실행
4. N + 1 문제 발생

해결방법

default는 지연로딩 기준

1. Fetch join

`@Query(”select t from test join fecth t2.t”)`

필요한 하위 앤티티의 정보도 같이 가져옴

한번의 쿼리로 필요한 정보를 전부 가져올 수 있다.

## ACID

트랜잭션을 안전하게 수행하고 데이터의 일관성을 보장하기 위한 4가지 특성

* Atomicity(원자성)
  
  **트랜잭션을 모두 실행 하거나 모두 실행하지 않는다.**

  트랜잭션은 논리적으로 쪼개질 수 없는 가장 작은 작업 단위이기 때문에 트랜잭션이 부분적으로 적용되거나 중간에 실패하면 안된다.

  중간에 하나라도 실패한다면 트랜잭션 이전으로 롤백
* Consistency(일관성)

   **트랜잭션 실행 전후로 DB의 일관성이 유지되어야 한다**

   트랜잭션 작업으로 DB에 정의된 규칙이 깨지면 안된다.

   만약 트랜잭션 작업 결과로 DB 무결성 규칙이 어긋난다면 롤백
* Isolation(고립성)

   **동시에 실행되는 트랜잭션은 서로 독립적이어야 한다**

   여러 트랜잭션이 동시에 실행되어도 실행 도중의 결과가 다른 작업에 영향을 끼쳐서는 안된다.

   각 트랜잭션은 다른 트랜잭션 작업의 끼어들 수 없고 연산 결과를 확인할 수 없다.
* Durability(지속성)

   **트랜잭션이 성공하면 결과가 영구적으로 유지되어야 한다**

   트랜잭션의 결과가 문제가 없어 롤백없이 커밋이 완료되었다면 영구적으로 DB에 결과가 저장되어야한다.